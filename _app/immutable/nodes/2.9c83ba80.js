import{s as We,f as E,a as ee,l as Z,g as I,h as M,d as g,c as te,m as Q,j as A,k as Jt,i as K,x as p,A as _e,B as H,y as Fe,C as qe,D as be,E as mt,o as vt,e as Xe,n as ae,p as yt,F as de,G as Xt,H as At,I as kt,J as Zt}from"../chunks/scheduler.dc23dc69.js";import{S as xe,i as ze,b as Ze,d as Qe,m as Ye,a as $e,t as et,e as tt}from"../chunks/index.df494a3a.js";import{b as St}from"../chunks/paths.7dce6b79.js";const Qt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function oe(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}let re;const ce=new Array(32).fill(void 0);ce.push(void 0,null,!0,!1);function F(t){return ce[t]}let ke=ce.length;function Yt(t){t<36||(ce[t]=ke,ke=t)}function De(t){const e=F(t);return Yt(t),e}const Ft=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Ft.decode();let Pe=new Uint8Array;function Se(){return Pe.byteLength===0&&(Pe=new Uint8Array(re.memory.buffer)),Pe}function je(t,e){return Ft.decode(Se().subarray(t,t+e))}function X(t){ke===ce.length&&ce.push(ce.length+1);const e=ke;return ke=ce[e],ce[e]=t,e}let Te=0;const Le=new TextEncoder("utf-8"),$t=typeof Le.encodeInto=="function"?function(t,e){return Le.encodeInto(t,e)}:function(t,e){const n=Le.encode(t);return e.set(n),{read:t.length,written:n.length}};function nt(t,e,n){if(n===void 0){const a=Le.encode(t),f=e(a.length);return Se().subarray(f,f+a.length).set(a),Te=a.length,f}let l=t.length,r=e(l);const o=Se();let s=0;for(;s<l;s++){const a=t.charCodeAt(s);if(a>127)break;o[r+s]=a}if(s!==l){s!==0&&(t=t.slice(s)),r=n(r,l,l=s+t.length*3);const a=Se().subarray(r+s,r+l),f=$t(t,a);s+=f.written}return Te=s,r}function Ve(t){return t==null}let Ue=new Int32Array;function ue(){return Ue.byteLength===0&&(Ue=new Int32Array(re.memory.buffer)),Ue}let Me=new Float64Array;function en(){return Me.byteLength===0&&(Me=new Float64Array(re.memory.buffer)),Me}function Be(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const r=t.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=t.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(t)){const r=t.length;let o="[";r>0&&(o+=Be(t[0]));for(let s=1;s<r;s++)o+=", "+Be(t[s]);return o+="]",o}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let l;if(n.length>1)l=n[1];else return toString.call(t);if(l=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:l}function tn(t,e){return Se().subarray(t/1,t/1+e)}function nn(t){try{const s=re.__wbindgen_add_to_stack_pointer(-16);re.generate_puz(s,X(t));var e=ue()[s/4+0],n=ue()[s/4+1],l=ue()[s/4+2],r=ue()[s/4+3];if(r)throw De(l);var o=tn(e,n).slice();return re.__wbindgen_free(e,n*1),o}finally{re.__wbindgen_add_to_stack_pointer(16)}}function Ne(t,e){try{return t.apply(this,e)}catch(n){re.__wbindgen_exn_store(X(n))}}async function ln(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(l){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",l);else throw l}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function rn(){const t={};return t.wbg={},t.wbg.__wbindgen_object_drop_ref=function(e){De(e)},t.wbg.__wbindgen_is_string=function(e){return typeof F(e)=="string"},t.wbg.__wbindgen_error_new=function(e,n){const l=new Error(je(e,n));return X(l)},t.wbg.__wbindgen_string_get=function(e,n){const l=F(n),r=typeof l=="string"?l:void 0;var o=Ve(r)?0:nt(r,re.__wbindgen_malloc,re.__wbindgen_realloc),s=Te;ue()[e/4+1]=s,ue()[e/4+0]=o},t.wbg.__wbindgen_is_object=function(e){const n=F(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return F(e)===void 0},t.wbg.__wbindgen_in=function(e,n){return F(e)in F(n)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=F(e);return X(n)},t.wbg.__wbindgen_string_new=function(e,n){const l=je(e,n);return X(l)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return F(e)==F(n)},t.wbg.__wbindgen_boolean_get=function(e){const n=F(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_number_get=function(e,n){const l=F(n),r=typeof l=="number"?l:void 0;en()[e/8+1]=Ve(r)?0:r,ue()[e/4+0]=!Ve(r)},t.wbg.__wbg_getwithrefkey_15c62c2b8546208d=function(e,n){const l=F(e)[F(n)];return X(l)},t.wbg.__wbg_set_20cbc34131e76824=function(e,n,l){F(e)[De(n)]=De(l)},t.wbg.__wbg_get_57245cc7d7c7619d=function(e,n){const l=F(e)[n>>>0];return X(l)},t.wbg.__wbg_length_6e3bbe7c8bd4dbd8=function(e){return F(e).length},t.wbg.__wbindgen_is_function=function(e){return typeof F(e)=="function"},t.wbg.__wbg_new_268f7b7dd3430798=function(){return X(new Map)},t.wbg.__wbg_next_579e583d33566a86=function(e){const n=F(e).next;return X(n)},t.wbg.__wbg_next_aaef7c8aa5e212ac=function(){return Ne(function(e){const n=F(e).next();return X(n)},arguments)},t.wbg.__wbg_done_1b73b0672e15f234=function(e){return F(e).done},t.wbg.__wbg_value_1ccc36bc03462d71=function(e){const n=F(e).value;return X(n)},t.wbg.__wbg_iterator_6f9d4f28845f426c=function(){return X(Symbol.iterator)},t.wbg.__wbg_get_765201544a2b6869=function(){return Ne(function(e,n){const l=Reflect.get(F(e),F(n));return X(l)},arguments)},t.wbg.__wbg_call_97ae9d8645dc388b=function(){return Ne(function(e,n){const l=F(e).call(F(n));return X(l)},arguments)},t.wbg.__wbg_new_0b9bfdd97583284e=function(){const e=new Object;return X(e)},t.wbg.__wbg_isArray_27c46c67f498e15d=function(e){return Array.isArray(F(e))},t.wbg.__wbg_instanceof_ArrayBuffer_e5e48f4762c5610b=function(e){let n;try{n=F(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_set_933729cf5b66ac11=function(e,n,l){const r=F(e).set(F(n),F(l));return X(r)},t.wbg.__wbg_isSafeInteger_dfa0593e8d7ac35a=function(e){return Number.isSafeInteger(F(e))},t.wbg.__wbg_buffer_3f3d764d4747d564=function(e){const n=F(e).buffer;return X(n)},t.wbg.__wbg_new_8c3f0052272a457a=function(e){const n=new Uint8Array(F(e));return X(n)},t.wbg.__wbg_set_83db9690f9353e79=function(e,n,l){F(e).set(F(n),l>>>0)},t.wbg.__wbg_length_9e1ae1900cb0fbd5=function(e){return F(e).length},t.wbg.__wbg_instanceof_Uint8Array_971eeda69eb75003=function(e){let n;try{n=F(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_debug_string=function(e,n){const l=Be(F(n)),r=nt(l,re.__wbindgen_malloc,re.__wbindgen_realloc),o=Te;ue()[e/4+1]=o,ue()[e/4+0]=r},t.wbg.__wbindgen_throw=function(e,n){throw new Error(je(e,n))},t.wbg.__wbindgen_memory=function(){const e=re.memory;return X(e)},t}function sn(t,e){return re=t.exports,qt.__wbindgen_wasm_module=e,Me=new Float64Array,Ue=new Int32Array,Pe=new Uint8Array,re}async function qt(t){typeof t>"u"&&(t=new URL(""+new URL("../assets/xword_puz_bg.2a440b26.wasm",import.meta.url).href,self.location));const e=rn();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:l}=await ln(await t,e);return sn(n,l)}const Et=(t,e)=>{let n=[];for(let l=0;l<t.length;l+=e){const r=t.substring(l,l+e);n.push(r)}return n},on=(t,e)=>t.reduce((n,l,r)=>{let o=e(l,r);return o!=null&&n.push(o),n},[]),cn=t=>(e,n)=>{const l=t(e),r=t(n);for(let o=0;o<l.length;o++){if(l[o]<r[o])return-1;if(l[o]>r[o])return 1}return 0};const{window:un}=Qt;function lt(t,e,n){const l=t.slice();return l[60]=e[n],l[62]=n,l}function rt(t,e,n){const l=t.slice();l[60]=e[n],l[68]=n;const r=W*l[62]+l[68];l[63]=r;const o=l[2][l[63]];l[64]=o;const s=l[6].get(l[63]);l[65]=s;const a=l[1]&&l[1].x==l[68]&&l[1].y==l[62];return l[66]=a,l}function st(t){let e;return{c(){e=Z(" Selected")},l(n){e=Q(n," Selected")},m(n,l){K(n,e,l)},d(n){n&&g(e)}}}function ot(t){let e,n=t[64].number+"",l;return{c(){e=E("span"),l=Z(n),this.h()},l(r){e=I(r,"SPAN",{class:!0});var o=M(e);l=Q(o,n),o.forEach(g),this.h()},h(){A(e,"class","cell-number svelte-1oqq1rw")},m(r,o){K(r,e,o),p(e,l)},p(r,o){o[0]&4&&n!==(n=r[64].number+"")&&ae(l,n)},d(r){r&&g(e)}}}function an(t){let e,n=t[64].fill+"",l;return{c(){e=E("span"),l=Z(n),this.h()},l(r){e=I(r,"SPAN",{class:!0});var o=M(e);l=Q(o,n),o.forEach(g),this.h()},h(){A(e,"class","cell-fill svelte-1oqq1rw")},m(r,o){K(r,e,o),p(e,l)},p(r,o){o[0]&4&&n!==(n=r[64].fill+"")&&ae(l,n)},d(r){r&&g(e)}}}function fn(t){let e,n=t[65]+"",l;return{c(){e=E("span"),l=Z(n),this.h()},l(r){e=I(r,"SPAN",{class:!0});var o=M(e);l=Q(o,n),o.forEach(g),this.h()},h(){A(e,"class","cell-fill preview svelte-1oqq1rw")},m(r,o){K(r,e,o),p(e,l)},p(r,o){o[0]&64&&n!==(n=r[65]+"")&&ae(l,n)},d(r){r&&g(e)}}}function it(t){let e,n,l,r,o,s=t[64].number&&ot(t);function a(y,m){return!y[64].fill&&y[65]?fn:an}let f=a(t),d=f(t);function b(...y){return t[32](t[68],t[62],...y)}function k(...y){return t[33](t[68],t[62],...y)}function L(...y){return t[34](t[68],t[62],...y)}return{c(){e=E("div"),s&&s.c(),n=ee(),d.c(),l=ee(),this.h()},l(y){e=I(y,"DIV",{class:!0});var m=M(e);s&&s.l(m),n=te(m),d.l(m),l=te(m),m.forEach(g),this.h()},h(){A(e,"class","cell svelte-1oqq1rw"),de(e,"selected-area",t[17](t[1],t[68],t[62])),de(e,"selected",t[66]),de(e,"wall",t[64].wall),de(e,"error",t[64].fill.length>0&&t[64].fill.length<t[0])},m(y,m){K(y,e,m),s&&s.m(e,null),p(e,n),d.m(e,null),p(e,l),r||(o=[H(e,"mousedown",b),H(e,"mouseover",k),H(e,"contextmenu",L)],r=!0)},p(y,m){t=y,t[64].number?s?s.p(t,m):(s=ot(t),s.c(),s.m(e,n)):s&&(s.d(1),s=null),f===(f=a(t))&&d?d.p(t,m):(d.d(1),d=f(t),d&&(d.c(),d.m(e,l))),m[0]&131074&&de(e,"selected-area",t[17](t[1],t[68],t[62])),m[0]&2&&de(e,"selected",t[66]),m[0]&4&&de(e,"wall",t[64].wall),m[0]&5&&de(e,"error",t[64].fill.length>0&&t[64].fill.length<t[0])},d(y){y&&g(e),s&&s.d(),d.d(),r=!1,be(o)}}}function ct(t){let e,n=oe({length:W}),l=[];for(let r=0;r<n.length;r+=1)l[r]=it(rt(t,n,r));return{c(){for(let r=0;r<l.length;r+=1)l[r].c();e=Xe()},l(r){for(let o=0;o<l.length;o+=1)l[o].l(r);e=Xe()},m(r,o){for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(r,o);K(r,e,o)},p(r,o){if(o[0]&188487){n=oe({length:W});let s;for(s=0;s<n.length;s+=1){const a=rt(r,n,s);l[s]?l[s].p(a,o):(l[s]=it(a),l[s].c(),l[s].m(e.parentNode,e))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&g(e),qe(l,r)}}}function ut(t){let e,n,l=t[10].number+"",r,o,s,a,f,d,b,k,L=t[9].number+"",y,m,N,q,i,u,_;return{c(){e=E("div"),n=E("label"),r=Z(l),o=Z("A"),s=ee(),a=E("div"),f=E("input"),d=ee(),b=E("div"),k=E("label"),y=Z(L),m=Z("D"),N=ee(),q=E("div"),i=E("input"),this.h()},l(S){e=I(S,"DIV",{class:!0});var C=M(e);n=I(C,"LABEL",{for:!0,class:!0});var v=M(n);r=Q(v,l),o=Q(v,"A"),v.forEach(g),s=te(C),a=I(C,"DIV",{class:!0});var P=M(a);f=I(P,"INPUT",{id:!0,class:!0,type:!0}),P.forEach(g),C.forEach(g),d=te(S),b=I(S,"DIV",{class:!0});var T=M(b);k=I(T,"LABEL",{for:!0,class:!0});var B=M(k);y=Q(B,L),m=Q(B,"D"),B.forEach(g),N=te(T),q=I(T,"DIV",{class:!0});var O=M(q);i=I(O,"INPUT",{id:!0,class:!0,type:!0}),O.forEach(g),T.forEach(g),this.h()},h(){A(n,"for","across-clue"),A(n,"class","svelte-1oqq1rw"),A(f,"id","across-clue"),A(f,"class","fill-width svelte-1oqq1rw"),A(f,"type","text"),A(a,"class","flex-container svelte-1oqq1rw"),A(e,"class","clue svelte-1oqq1rw"),A(k,"for","down-clue"),A(k,"class","svelte-1oqq1rw"),A(i,"id","down-clue"),A(i,"class","fill-width svelte-1oqq1rw"),A(i,"type","text"),A(q,"class","flex-container svelte-1oqq1rw"),A(b,"class","clue svelte-1oqq1rw")},m(S,C){K(S,e,C),p(e,n),p(n,r),p(n,o),p(e,s),p(e,a),p(a,f),_e(f,t[10].acrossClue),K(S,d,C),K(S,b,C),p(b,k),p(k,y),p(k,m),p(b,N),p(b,q),p(q,i),_e(i,t[9].downClue),u||(_=[H(f,"input",t[36]),H(i,"input",t[37])],u=!0)},p(S,C){C[0]&1024&&l!==(l=S[10].number+"")&&ae(r,l),C[0]&1024&&f.value!==S[10].acrossClue&&_e(f,S[10].acrossClue),C[0]&512&&L!==(L=S[9].number+"")&&ae(y,L),C[0]&512&&i.value!==S[9].downClue&&_e(i,S[9].downClue)},d(S){S&&(g(e),g(d),g(b)),u=!1,be(_)}}}function dn(t){let e,n,l,r,o,s,a,f,d,b,k,L,y,m,N,q,i,u,_,S,C,v,P,T,B,O=t[11]&&st(),fe=oe({length:he}),G=[];for(let j=0;j<fe.length;j+=1)G[j]=ct(lt(t,fe,j));let Y=t[12]&&ut(t);return{c(){e=E("div"),n=E("div"),l=E("div"),r=E("div"),o=E("input"),s=ee(),a=E("div"),f=Z("by "),d=E("input"),b=ee(),k=E("button"),L=Z("Export"),O&&O.c(),y=ee(),m=E("button"),N=Z("Undo"),i=ee(),u=E("button"),_=Z("Redo"),C=ee(),v=E("div");for(let j=0;j<G.length;j+=1)G[j].c();P=ee(),Y&&Y.c(),this.h()},l(j){e=I(j,"DIV",{id:!0,class:!0});var J=M(e);n=I(J,"DIV",{class:!0});var V=M(n);l=I(V,"DIV",{class:!0});var ie=M(l);r=I(ie,"DIV",{class:!0});var ge=M(r);o=I(ge,"INPUT",{class:!0,type:!0}),ge.forEach(g),s=te(ie),a=I(ie,"DIV",{class:!0});var pe=M(a);f=Q(pe,"by "),d=I(pe,"INPUT",{class:!0,type:!0}),pe.forEach(g),ie.forEach(g),b=te(V),k=I(V,"BUTTON",{class:!0});var me=M(k);L=Q(me,"Export"),O&&O.l(me),me.forEach(g),y=te(V),m=I(V,"BUTTON",{class:!0});var Ee=M(m);N=Q(Ee,"Undo"),Ee.forEach(g),i=te(V),u=I(V,"BUTTON",{class:!0});var Ie=M(u);_=Q(Ie,"Redo"),Ie.forEach(g),V.forEach(g),C=te(J),v=I(J,"DIV",{id:!0,tabindex:!0,style:!0,class:!0});var Ce=M(v);for(let ve=0;ve<G.length;ve+=1)G[ve].l(Ce);Ce.forEach(g),P=te(J),Y&&Y.l(J),J.forEach(g),this.h()},h(){A(o,"class","title fill-width svelte-1oqq1rw"),A(o,"type","text"),A(r,"class","flex-container svelte-1oqq1rw"),A(d,"class","fill-width svelte-1oqq1rw"),A(d,"type","text"),A(a,"class","flex-container svelte-1oqq1rw"),A(l,"class","meta svelte-1oqq1rw"),A(k,"class","svelte-1oqq1rw"),A(m,"class","push svelte-1oqq1rw"),m.disabled=q=t[3].length===0,u.disabled=S=t[4].length===0,A(u,"class","svelte-1oqq1rw"),A(n,"class","header svelte-1oqq1rw"),A(v,"id","grid"),A(v,"tabindex","0"),Jt(v,"grid-template-columns","repeat("+W+", 1fr)"),A(v,"class","svelte-1oqq1rw"),A(e,"id","grid-wrapper"),A(e,"class","svelte-1oqq1rw")},m(j,J){K(j,e,J),p(e,n),p(n,l),p(l,r),p(r,o),_e(o,t[7]),p(l,s),p(l,a),p(a,f),p(a,d),_e(d,t[8]),p(n,b),p(n,k),p(k,L),O&&O.m(k,null),p(n,y),p(n,m),p(m,N),p(n,i),p(n,u),p(u,_),p(e,C),p(e,v);for(let V=0;V<G.length;V+=1)G[V]&&G[V].m(v,null);t[35](v),p(e,P),Y&&Y.m(e,null),T||(B=[H(un,"mouseup",t[29]),H(o,"input",t[30]),H(d,"input",t[31]),H(k,"click",t[20]),H(m,"click",t[18]),H(u,"click",t[19]),H(v,"keydown",t[16]),H(v,"contextmenu",_n)],T=!0)},p(j,J){if(J[0]&128&&o.value!==j[7]&&_e(o,j[7]),J[0]&256&&d.value!==j[8]&&_e(d,j[8]),j[11]?O||(O=st(),O.c(),O.m(k,null)):O&&(O.d(1),O=null),J[0]&8&&q!==(q=j[3].length===0)&&(m.disabled=q),J[0]&16&&S!==(S=j[4].length===0)&&(u.disabled=S),J[0]&188487){fe=oe({length:he});let V;for(V=0;V<fe.length;V+=1){const ie=lt(j,fe,V);G[V]?G[V].p(ie,J):(G[V]=ct(ie),G[V].c(),G[V].m(v,null))}for(;V<G.length;V+=1)G[V].d(1);G.length=fe.length}j[12]?Y?Y.p(j,J):(Y=ut(j),Y.c(),Y.m(e,null)):Y&&(Y.d(1),Y=null)},i:Fe,o:Fe,d(j){j&&g(e),O&&O.d(),qe(G,j),t[35](null),Y&&Y.d(),T=!1,be(B)}}}const he=20,W=20,_n=t=>t.preventDefault();function hn(t,e,n){let l,r,o,s,a,{cellFillLen:f}=e;const d=c=>Et(c,f),b=mt();let k=[],L=[],y,m=new Map,N="Untitled",q="Anonymous",i=null,u=Array(W*he).fill(null).map(()=>({wall:!1,fill:"",number:null,downClue:null,acrossClue:null}));const _=c=>{n(1,i={x:c.x,y:c.y,x2:c.x,y2:c.y}),S()},S=()=>{if(!i)return;let c=i.y*W+i.x;b("update",{downPattern:B(i),acrossPattern:T(i),cell:u[c]})},C=c=>({x:w,y:h,...D})=>c({x:w,y:h,...D,front:0,back:u.length,step:W}),v=c=>({x:w,y:h,...D})=>{const U=h*W;return c({x:w,y:h,...D,front:U,back:U+W,step:1})},P=({front:c,back:w,step:h,x:D,y:U})=>{let x=-1,R=U*W+D;if(u[R].wall)return null;for(;R>=c&&!u[R].wall;R-=h)x++;const ne=R+h,z=[];for(R=ne;R<w&&!u[R].wall;R+=h){const se=u[R].fill;(!se.length||se.length==f)&&z.push(se)}return{pattern:z,index:x}},T=v(P),B=C(P),O=({front:c,back:w,step:h,x:D,y:U,word:$,pivotIdx:x})=>{let R=U*W+D-x*h;const ne=[];c<=R-h&&ne.push({idx:R-h,is:{fill:"",wall:!0}});for(const z of d($))ne.push({idx:R,is:{fill:z,wall:!1}}),R+=h;R<w&&ne.push({idx:R,is:{fill:"",wall:!0}}),Ae("Set fill",ne),y.focus(),ye(),S()},fe=v(O),G=C(O),Y=({...c})=>fe({...i,...c}),j=({...c})=>G({...i,...c}),J=({front:c,step:w,x:h,y:D,grid:U})=>{if(h==null||D==null)return{};let $=h+W*D;if(!U[$])return null;for(;$>=c&&!U[$].wall;$-=w);return U[$+w]},V=v(J),ie=C(J),ge=({front:c,back:w,step:h,x:D,y:U,word:$,pivotIdx:x})=>{let R=U*W+D-x*h;m.clear();for(const ne of d($))m.set(R,ne),R+=h;n(6,m)},pe=v(ge),me=C(ge),Ee=({...c})=>pe({...i,...c}),Ie=({...c})=>me({...i,...c}),Ce=c=>{let w=i.y*W+i.x;m.clear(),m.set(w,c),n(6,m)},ve=()=>{m.clear(),n(6,m)},Dt=c=>{Ae("Set fill",[{idx:i.y*W+i.x,is:{wall:!1,fill:c}}]),y.focus(),S()},He=(c,w,h)=>{c.preventDefault();const D=h*W+w;Ae("Toggle wall",[{idx:D,is:{fill:"",wall:!u[D].wall}}]),ye()},Ke=(c,w,h)=>{let D=1;const U=({idx:x,topBounded:R,leftBounded:ne})=>{const z=c[x],se=R||ne;z.number=null,R?z.downClue??(z.downClue=""):z.downClue=null,ne?z.acrossClue??(z.acrossClue=""):z.acrossClue=null,!z.wall&&se&&(z.number=D,D++)};let $=!0;for(let x=0;x<w;x++)U({idx:x,topBounded:!0,leftBounded:$}),$=c[x].wall;for(let x=1;x<h;x++){const R=x*w,ne=c[R-w].wall;U({idx:R,topBounded:ne,leftBounded:!0});for(let z=1;z<w;z++){const se=R+z,Je=c[se-w].wall,le=c[se-1].wall;U({idx:se,topBounded:Je,leftBounded:le})}}},ye=()=>Ke(u,W,he),Ge=({event:c,x:w,y:h})=>{c.buttons!=1||(i==null?void 0:i.state)!=="area"||(n(1,i.x2=w,i),n(1,i.y2=h,i))},Pt=c=>{switch(c.keyCode){case 37:c.preventDefault(),i&&i.x>0&&_({x:i.x-1,y:i.y});break;case 38:c.preventDefault(),i&&i.y>0&&_({x:i.x,y:i.y-1});break;case 39:c.preventDefault(),i&&i.x<W-1&&_({x:i.x+1,y:i.y});break;case 40:c.preventDefault(),i&&i.y<he-1&&_({x:i.x,y:i.y+1});break;case 8:if(!i)return;const w=i.y*W+i.x;u[w].fill.length?Ae("Delete cell contents",[{idx:w,is:{fill:""}}]):i.x!=0&&!u[w-1].wall&&_({x:i.x-1,y:i.y});break;default:if(!i||c.ctrlKey||c.altKey||c.metaKey)return;if(c.keyCode>64&&c.keyCode<91){const h=String.fromCharCode(c.keyCode),D=i.y*W+i.x;if(u[D].wall)return;if(u[D].fill.length<f){const U=u[D].fill+h;Ae("Type character",[{idx:D,is:{fill:U}}])}}}},Lt=(c,w,h)=>{if(!c)return!1;const D=Math.min(c.x,c.x2),U=Math.max(c.x,c.x2),$=Math.min(c.y,c.y2),x=Math.max(c.y,c.y2);return D<=w&&w<=U&&$<=h&&h<=x},Ae=(c,w)=>{for(let h of w){const D=Object.keys(h.is);h.was=Object.fromEntries(D.map(U=>[U,u[h.idx][U]])),n(2,u[h.idx]={...u[h.idx],...h.is},u)}k.push({action:c,updates:w}),n(3,k),n(4,L=[]),S()},Ut=()=>{let c=k.pop();L.push(c);for(let w of c.updates)n(2,u[w.idx]={...u[w.idx],...w.was},u);n(3,k),n(4,L),ye(),y.focus(),S()},Mt=()=>{let c=L.pop();k.push(c);for(let w of c.updates)n(2,u[w.idx]={...u[w.idx],...w.is},u);n(3,k),n(4,L),ye(),y.focus(),S()},Tt=(c,w)=>{const h=document.createElement("a");h.href=c,h.download=w,document.body.appendChild(h),h.style.display="none",h.click(),h.remove()},Rt=(c,w,h)=>{const D=new Blob([c],{type:h}),U=window.URL.createObjectURL(D);Tt(U,w),setTimeout(()=>window.URL.revokeObjectURL(U),1e3)},Ot=()=>{let c,w,h,D;o?(c=Math.min(i.x,i.x2),w=Math.max(i.x,i.x2),h=Math.min(i.y,i.y2),D=Math.max(i.y,i.y2)):(c=0,h=0,w=W-1,D=he-1);const U=[],$=D-h+1,x=w-c+1;for(let le=h;le<=D;le++)for(let Oe=c;Oe<=w;Oe++){const Gt=le*W+Oe;U.push({...u[Gt]})}Ke(U,$,x);const R=[],ne=[];for(const le of U)le.acrossClue!=null&&R.push([le.number,le.acrossClue]),le.downClue!=null&&ne.push([le.number,le.downClue]);const z=U.map(le=>le.wall?null:le.fill),se=nn({width:$,height:x,grid:z,acrossClues:R,downClues:ne,title:N,author:q});Rt(se,`${N||"Untitled"}.puz`,"application/octet-stream")};ye(),vt(async()=>{await qt()});const jt=()=>i&&n(1,i.state=null,i);function Vt(){N=this.value,n(7,N)}function Nt(){q=this.value,n(8,q)}const Bt=(c,w,h)=>{h.buttons===1&&(_({x:c,y:w}),n(1,i.state="area",i))},Wt=(c,w,h)=>Ge({event:h,x:c,y:w}),xt=(c,w,h)=>He(h,c,w);function zt(c){yt[c?"unshift":"push"](()=>{y=c,n(5,y)})}function Ht(){s.acrossClue=this.value,n(10,s),n(1,i),n(2,u)}function Kt(){a.downClue=this.value,n(9,a),n(1,i),n(2,u)}return t.$$set=c=>{"cellFillLen"in c&&n(0,f=c.cellFillLen)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(28,l=i&&u[i.x+i.y*W]),t.$$.dirty[0]&268435456&&n(12,r=l&&!l.wall),t.$$.dirty[0]&2&&n(11,o=i&&(i.x!=i.x2||i.y!=i.y2)),t.$$.dirty[0]&6&&n(10,s=V({...i,grid:u})),t.$$.dirty[0]&6&&n(9,a=ie({...i,grid:u}))},[f,i,u,k,L,y,m,N,q,a,s,o,r,_,He,Ge,Pt,Lt,Ut,Mt,Ot,Y,j,Ee,Ie,Ce,ve,Dt,l,jt,Vt,Nt,Bt,Wt,xt,zt,Ht,Kt]}class wn extends xe{constructor(e){super(),ze(this,e,hn,dn,We,{cellFillLen:0,setAcrossFillAtSelected:21,setDownFillAtSelected:22,setPreviewAcrossAtSelected:23,setPreviewDownAtSelected:24,setPreviewAtSelected:25,clearPreview:26,setFillAtSelected:27},null,[-1,-1,-1])}get setAcrossFillAtSelected(){return this.$$.ctx[21]}get setDownFillAtSelected(){return this.$$.ctx[22]}get setPreviewAcrossAtSelected(){return this.$$.ctx[23]}get setPreviewDownAtSelected(){return this.$$.ctx[24]}get setPreviewAtSelected(){return this.$$.ctx[25]}get clearPreview(){return this.$$.ctx[26]}get setFillAtSelected(){return this.$$.ctx[27]}}function at(t,e,n){const l=t.slice();return l[16]=e[n],l}function ft(t,e,n){const l=t.slice();return l[19]=e[n],l}function dt(t,e,n){const l=t.slice();return l[19]=e[n],l}function bn(t){let e,n=`<img class="spinner svelte-1q31v9d" src="${St}/spinner.gif" alt="loading fill suggestions"/>`;return{c(){e=E("div"),e.innerHTML=n,this.h()},l(l){e=I(l,"DIV",{class:!0,"data-svelte-h":!0}),Xt(e)!=="svelte-y52rrk"&&(e.innerHTML=n),this.h()},h(){A(e,"class","spinner-container svelte-1q31v9d")},m(l,r){K(l,e,r)},p:Fe,d(l){l&&g(e)}}}function gn(t){var _,S,C;let e,n,l=(((_=t[1])==null?void 0:_.length)??"?")+"",r,o,s,a,f=(((S=t[2])==null?void 0:S.length)??"?")+"",d,b,k,L,y=(((C=t[3])==null?void 0:C.length)??"?")+"",m,N,q=t[1]&&_t(t),i=t[2]&&wt(t),u=t[3]&&gt(t);return{c(){e=E("ul"),n=E("li"),r=Z(l),o=Z(` potential across fills.
        `),q&&q.c(),s=ee(),a=E("li"),d=Z(f),b=Z(` potential down fills.
        `),i&&i.c(),k=ee(),L=E("li"),m=Z(y),N=Z(` potential fills for this cell:
        `),u&&u.c()},l(v){e=I(v,"UL",{});var P=M(e);n=I(P,"LI",{});var T=M(n);r=Q(T,l),o=Q(T,` potential across fills.
        `),q&&q.l(T),T.forEach(g),s=te(P),a=I(P,"LI",{});var B=M(a);d=Q(B,f),b=Q(B,` potential down fills.
        `),i&&i.l(B),B.forEach(g),k=te(P),L=I(P,"LI",{});var O=M(L);m=Q(O,y),N=Q(O,` potential fills for this cell:
        `),u&&u.l(O),O.forEach(g),P.forEach(g)},m(v,P){K(v,e,P),p(e,n),p(n,r),p(n,o),q&&q.m(n,null),p(e,s),p(e,a),p(a,d),p(a,b),i&&i.m(a,null),p(e,k),p(e,L),p(L,m),p(L,N),u&&u.m(L,null)},p(v,P){var T,B,O;P&2&&l!==(l=(((T=v[1])==null?void 0:T.length)??"?")+"")&&ae(r,l),v[1]?q?q.p(v,P):(q=_t(v),q.c(),q.m(n,null)):q&&(q.d(1),q=null),P&4&&f!==(f=(((B=v[2])==null?void 0:B.length)??"?")+"")&&ae(d,f),v[2]?i?i.p(v,P):(i=wt(v),i.c(),i.m(a,null)):i&&(i.d(1),i=null),P&8&&y!==(y=(((O=v[3])==null?void 0:O.length)??"?")+"")&&ae(m,y),v[3]?u?u.p(v,P):(u=gt(v),u.c(),u.m(L,null)):u&&(u.d(1),u=null)},d(v){v&&g(e),q&&q.d(),i&&i.d(),u&&u.d()}}}function _t(t){let e,n=oe(t[1].slice(0,Re)),l=[];for(let r=0;r<n.length;r+=1)l[r]=ht(dt(t,n,r));return{c(){e=E("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var o=M(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(g),this.h()},h(){A(e,"class","word-grid svelte-1q31v9d")},m(r,o){K(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&50){n=oe(r[1].slice(0,Re));let s;for(s=0;s<n.length;s+=1){const a=dt(r,n,s);l[s]?l[s].p(a,o):(l[s]=ht(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&g(e),qe(l,r)}}}function ht(t){let e,n,l=t[5](t[19])+"",r,o,s;function a(){return t[7](t[19])}function f(){return t[8](t[19])}return{c(){e=E("a"),n=new At(!1),r=ee(),this.h()},l(d){e=I(d,"A",{class:!0});var b=M(e);n=kt(b,!1),r=te(b),b.forEach(g),this.h()},h(){n.a=r,A(e,"class","svelte-1q31v9d")},m(d,b){K(d,e,b),n.m(l,e),p(e,r),o||(s=[H(e,"click",a),H(e,"mouseover",f),H(e,"mouseout",t[9])],o=!0)},p(d,b){t=d,b&2&&l!==(l=t[5](t[19])+"")&&n.p(l)},d(d){d&&g(e),o=!1,be(s)}}}function wt(t){let e,n=oe(t[2].slice(0,Re)),l=[];for(let r=0;r<n.length;r+=1)l[r]=bt(ft(t,n,r));return{c(){e=E("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var o=M(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(g),this.h()},h(){A(e,"class","word-grid svelte-1q31v9d")},m(r,o){K(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&52){n=oe(r[2].slice(0,Re));let s;for(s=0;s<n.length;s+=1){const a=ft(r,n,s);l[s]?l[s].p(a,o):(l[s]=bt(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&g(e),qe(l,r)}}}function bt(t){let e,n,l=t[5](t[19])+"",r,o,s;function a(){return t[10](t[19])}function f(){return t[11](t[19])}return{c(){e=E("a"),n=new At(!1),r=ee(),this.h()},l(d){e=I(d,"A",{class:!0});var b=M(e);n=kt(b,!1),r=te(b),b.forEach(g),this.h()},h(){n.a=r,A(e,"class","svelte-1q31v9d")},m(d,b){K(d,e,b),n.m(l,e),p(e,r),o||(s=[H(e,"click",a),H(e,"mouseover",f),H(e,"mouseout",t[12])],o=!0)},p(d,b){t=d,b&4&&l!==(l=t[5](t[19])+"")&&n.p(l)},d(d){d&&g(e),o=!1,be(s)}}}function gt(t){let e,n=oe(t[3]),l=[];for(let r=0;r<n.length;r+=1)l[r]=pt(at(t,n,r));return{c(){e=E("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=I(r,"DIV",{class:!0});var o=M(e);for(let s=0;s<l.length;s+=1)l[s].l(o);o.forEach(g),this.h()},h(){A(e,"class","letter-grid svelte-1q31v9d")},m(r,o){K(r,e,o);for(let s=0;s<l.length;s+=1)l[s]&&l[s].m(e,null)},p(r,o){if(o&24){n=oe(r[3]);let s;for(s=0;s<n.length;s+=1){const a=at(r,n,s);l[s]?l[s].p(a,o):(l[s]=pt(a),l[s].c(),l[s].m(e,null))}for(;s<l.length;s+=1)l[s].d(1);l.length=n.length}},d(r){r&&g(e),qe(l,r)}}}function pt(t){let e,n=t[16]+"",l,r,o;function s(){return t[13](t[16])}function a(){return t[14](t[16])}return{c(){e=E("a"),l=Z(n),this.h()},l(f){e=I(f,"A",{class:!0});var d=M(e);l=Q(d,n),d.forEach(g),this.h()},h(){A(e,"class","svelte-1q31v9d")},m(f,d){K(f,e,d),p(e,l),r||(o=[H(e,"click",s),H(e,"mouseover",a),H(e,"mouseout",t[15])],r=!0)},p(f,d){t=f,d&8&&n!==(n=t[16]+"")&&ae(l,n)},d(f){f&&g(e),r=!1,be(o)}}}function pn(t){let e;function n(o,s){return o[0]?gn:bn}let l=n(t),r=l(t);return{c(){e=E("div"),r.c(),this.h()},l(o){e=I(o,"DIV",{id:!0,class:!0});var s=M(e);r.l(s),s.forEach(g),this.h()},h(){A(e,"id","cell-data"),A(e,"class","svelte-1q31v9d")},m(o,s){K(o,e,s),r.m(e,null)},p(o,[s]){l===(l=n(o))&&r?r.p(o,s):(r.d(1),r=l(o),r&&(r.c(),r.m(e,null)))},i:Fe,o:Fe,d(o){o&&g(e),r.d()}}}const Re=100;function mn(t,e,n){let{dict:l}=e,{acrossFills:r}=e,{downFills:o}=e,{cellFills:s}=e,{cellFillLen:a}=e;const f=mt(),d=({entry:_,pivotIdx:S})=>{const C=S*a,v=C+a,P=_.word.slice(0,C),T=_.word.slice(C,v),B=_.word.slice(v);return`${P}<strong>${T}</strong>${B}`},b=_=>f("fillAcross",{word:_.entry.word,pivotIdx:_.pivotIdx}),k=_=>f("previewAcross",{word:_.entry.word,pivotIdx:_.pivotIdx}),L=()=>f("clearPreview"),y=_=>f("fillDown",{word:_.entry.word,pivotIdx:_.pivotIdx}),m=_=>f("previewDown",{word:_.entry.word,pivotIdx:_.pivotIdx}),N=()=>f("clearPreview"),q=_=>f("fillCell",{fill:_}),i=_=>f("previewCell",{fill:_}),u=()=>f("clearPreview");return t.$$set=_=>{"dict"in _&&n(0,l=_.dict),"acrossFills"in _&&n(1,r=_.acrossFills),"downFills"in _&&n(2,o=_.downFills),"cellFills"in _&&n(3,s=_.cellFills),"cellFillLen"in _&&n(6,a=_.cellFillLen)},[l,r,o,s,f,d,a,b,k,L,y,m,N,q,i,u]}class vn extends xe{constructor(e){super(),ze(this,e,mn,pn,We,{dict:0,acrossFills:1,downFills:2,cellFills:3,cellFillLen:6})}}const It=2,Ct=t=>Et(t,It),yn=async()=>{const e=await(await fetch(`${St}/dict/words.txt`)).text(),n=on(e.split(`
`),kn),l=new Map;for(const r of n){const o=r.chunks;delete r.chunks;for(const s of o){const a=l.get(s)||[];a.push(r),l.set(s,a)}}return{entries:n,chunkIndex:l,filterFit:An}};function An(t,e){let n=[],l=new Set;const r=s=>{let a=t[s],f=this.chunkIndex.get(a)||[];for(const d of f){const b=Ct(d.word);for(const[k,L]of b.entries())if(L==a){const y=s-k,m=y+b.length,N=e-y;if(N<0||N>=b.length)continue;const q=b[N];if(y<0||y>0&&t[y-1]||m>t.length||m<t.length&&t[m]||!b.every((u,_)=>{const S=t[y+_];return!S||S==u}))continue;n.push({entry:d,pivotIdx:N}),l.add(q)}}};if(t[e])r(e);else{for(let s=e;s>=0;s--)if(t[s]){r(s);break}for(let s=e;s<t.length;s++)if(t[s]){r(s);break}}n.sort(cn(s=>[-s.entry.score,s.entry.word,s.pivotIdx]));let o=null;return n=n.reduce((s,a)=>(o&&a.pivotIdx==o.pivotIdx&&a.entry==o.entry||(s.push(a),o=a),s),[]),{gridFills:n,cellFills:l}}const kn=t=>{let[e,n]=t.split(";");if(!e.match(`^([A-Z]{${It}})+$`))return null;const l=new Set(Ct(e));return n=+n,{word:e,score:n,chunks:l}};function Sn(t){let e,n,l,r,o,s,a={cellFillLen:we};return l=new wn({props:a}),t[6](l),l.$on("update",t[5]),o=new vn({props:{dict:t[1],downFills:t[2],acrossFills:t[3],cellFills:t[4],cellFillLen:we}}),o.$on("fillAcross",t[7]),o.$on("fillDown",t[8]),o.$on("fillCell",t[9]),o.$on("previewAcross",t[10]),o.$on("previewDown",t[11]),o.$on("previewCell",t[12]),o.$on("clearPreview",t[13]),{c(){e=ee(),n=E("div"),Ze(l.$$.fragment),r=ee(),Ze(o.$$.fragment),this.h()},l(f){Zt("svelte-ckbzzi",document.head).forEach(g),e=te(f),n=I(f,"DIV",{id:!0,class:!0});var b=M(n);Qe(l.$$.fragment,b),r=te(b),Qe(o.$$.fragment,b),b.forEach(g),this.h()},h(){document.title="Pair XWord Setter",A(n,"id","body-wrapper"),A(n,"class","svelte-i647o8")},m(f,d){K(f,e,d),K(f,n,d),Ye(l,n,null),p(n,r),Ye(o,n,null),s=!0},p(f,[d]){const b={};l.$set(b);const k={};d&2&&(k.dict=f[1]),d&4&&(k.downFills=f[2]),d&8&&(k.acrossFills=f[3]),d&16&&(k.cellFills=f[4]),o.$set(k)},i(f){s||($e(l.$$.fragment,f),$e(o.$$.fragment,f),s=!0)},o(f){et(l.$$.fragment,f),et(o.$$.fragment,f),s=!1},d(f){f&&(g(e),g(n)),t[6](null),tt(l),tt(o)}}}const we=2;function Fn(t,e,n){let l,r=null,o=null,s=null,a=null;vt(async()=>{n(1,r=await yn())});const f=(u,_)=>{if(!u||!_)return u||_;let S=new Set;for(const C of _)u.has(C)&&S.add(C);return S},d=u=>{var C;if(l.clearPreview(),(C=u.detail.cell)!=null&&C.wall){n(2,o=null),n(3,s=null),n(4,a=null);return}let _;const S=({pattern:v,index:P})=>{if(v.some(T=>T)){const{gridFills:T,cellFills:B}=r.filterFit(v,P);return _=f(_,B),T}return null};n(2,o=S(u.detail.downPattern)),n(3,s=S(u.detail.acrossPattern)),n(2,o=o==null?void 0:o.filter(({entry:v,pivotIdx:P})=>{let T=P*we,B=v.word.slice(T,T+we);return _.has(B)})),n(3,s=s==null?void 0:s.filter(({entry:v,pivotIdx:P})=>{let T=P*we,B=v.word.slice(T,T+we);return _.has(B)})),_!=null?(n(4,a=[..._]),a.sort()):n(4,a=null)};function b(u){yt[u?"unshift":"push"](()=>{l=u,n(0,l)})}return[l,r,o,s,a,d,b,u=>l.setAcrossFillAtSelected(u.detail),u=>l.setDownFillAtSelected(u.detail),u=>l.setFillAtSelected(u.detail.fill),u=>l.setPreviewAcrossAtSelected(u.detail),u=>l.setPreviewDownAtSelected(u.detail),u=>l.setPreviewAtSelected(u.detail.fill),u=>l.clearPreview()]}class Cn extends xe{constructor(e){super(),ze(this,e,Fn,Sn,We,{})}}export{Cn as component};
